<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Logisches Datenmodell</title>
    
    <!-- Google Material Symbols (Rounded) -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0" />

    <style>
        /* --- 1. VARIABLES & RESET --- */
        :root {
            --swiss-red: #DC0018;
            --text-black: #222222;
            --text-dark: #333333;
            --text-light: #666666;
            --border: #CCCCCC;
            --bg-gray: #F5F5F5;
            --font-stack: "Frutiger", "Helvetica Neue", Helvetica, Arial, sans-serif;
        }

        body { 
            margin: 0; 
            font-family: var(--font-stack); 
            color: var(--text-dark); 
            background: white;
            -webkit-font-smoothing: antialiased;
        }
        
        * { box-sizing: border-box; }
        a { text-decoration: none; color: inherit; cursor: pointer; }

        .hidden { display: none !important; }

        /* Helper for Icons */
        .material-symbols-rounded {
            font-size: 20px;
            vertical-align: middle;
            user-select: none;
        }

        /* --- 2. LAYOUT CONTAINER --- */
        .container {
            max-width: 1160px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* --- 3. HEADER --- */
        header { padding-top: 30px; padding-bottom: 20px; }
        
        .header-inner {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
        }

        .branding { display: flex; align-items: flex-start; gap: 20px; }
        .swiss-shield {
            width: 40px; height: 40px; 
            background: var(--swiss-red);
            position: relative; 
            border-radius: 0 0 50% 50%;
            display: flex; align-items: center; justify-content: center;
        }
        .swiss-cross { position: relative; width: 20px; height: 20px; }
        .swiss-cross::before, .swiss-cross::after {
            content: ""; position: absolute; background: white;
            top: 50%; left: 50%; transform: translate(-50%, -50%);
        }
        .swiss-cross::before { width: 16px; height: 4px; }
        .swiss-cross::after { width: 4px; height: 16px; }

        .branding-text {
            border-left: 1px solid #999;
            padding-left: 20px;
            font-size: 16px;
            line-height: 1.3;
        }
        .branding-text strong { display: block; font-weight: 700; color: var(--text-black); }
        .branding-text span { display: block; color: var(--text-black); font-size: 15px; }

        .top-meta { font-size: 14px; display: flex; gap: 25px; color: var(--text-black); }
        .lang-selector { font-weight: bold; display: flex; align-items: center; gap: 2px; cursor: pointer; }
        .lang-selector .material-symbols-rounded { font-size: 18px; }

        /* --- 4. NAVIGATION TABS --- */
        .nav-tabs {
            margin-top: 45px;
            border-bottom: 1px solid #E5E5E5;
            display: flex;
            gap: 35px;
        }
        .nav-link {
            padding-bottom: 15px;
            font-size: 16px;
            color: var(--text-black);
            position: relative;
            cursor: pointer;
        }
        .nav-link.active {
            border-bottom: 3px solid var(--swiss-red);
            margin-bottom: -1px;
        }

        /* --- 5. BREADCRUMBS & ACTION ICONS --- */
        .sub-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px 0;
        }
        .breadcrumbs { font-size: 14px; color: var(--text-light); }
        .breadcrumbs span { margin: 0 8px; color: #999; }
        .breadcrumbs a:hover { text-decoration: underline; }

        .action-icons { display: flex; gap: 12px; color: #666; }
        .icon-btn { 
            cursor: pointer; 
            padding: 8px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
        }
        .icon-btn:hover { background-color: #F5F5F5; color: var(--swiss-red); }
        .icon-btn .material-symbols-rounded { font-size: 22px; }

        /* --- 6. PAGE TITLE & CONTROLS --- */
        h1.page-title {
            font-size: 34px;
            font-weight: 400;
            margin: 10px 0 40px 0;
            color: var(--text-black);
        }

        .toolbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
        }
        .search-group { display: flex; gap: 15px; width: 100%; max-width: 500px; }
        .input-wrapper { position: relative; flex-grow: 1; }
        .input-wrapper input {
            width: 100%; padding: 10px 15px 10px 48px;
            border: 1px solid #999; border-radius: 3px; font-size: 16px; height: 46px;
        }
        .search-icon {
            position: absolute; left: 14px; top: 50%; transform: translateY(-50%);
            color: #666; pointer-events: none; font-size: 22px;
        }
        
        .btn-filter {
            height: 46px; padding: 0 24px; background: white;
            border: 1px solid #333; border-radius: 3px;
            font-size: 15px; font-weight: bold;
            display: flex; align-items: center; gap: 8px; cursor: pointer;
        }
        .btn-filter .material-symbols-rounded { font-size: 20px; }

        .view-toggles { display: flex; gap: 10px; }
        .toggle-icon {
            width: 46px; height: 46px; background: #999;
            display: flex; align-items: center; justify-content: center;
            color: white; border-radius: 3px; cursor: pointer;
            transition: background-color 0.2s;
        }
        .toggle-icon:hover { opacity: 0.8; }
        .toggle-icon.active { background: #666; color: white; pointer-events: none; }
        .toggle-icon.inactive { background: white; color: #333; border: 1px solid #ccc; }

        /* --- 7. GRID VIEW --- */
        .grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 30px;
            margin-bottom: 80px;
        }
        @media (max-width: 1000px) { .grid { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 600px) { .grid { grid-template-columns: 1fr; } }

        .card {
            background: white;
            border: 1px solid #E5E5E5;
            border-radius: 4px;
            overflow: hidden;
            display: flex; flex-direction: column;
            box-shadow: 0 2px 5px rgba(0,0,0,0.02);
            transition: all 0.2s;
            cursor: pointer;
        }
        .card:hover {
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            transform: translateY(-3px);
            border-color: #ccc;
        }
        .card-img-wrap { height: 220px; position: relative; background: #eee; }
        .card-img { width: 100%; height: 100%; object-fit: cover; }
        .tags-overlay { position: absolute; top: 20px; left: 20px; display: flex; gap: 10px; }
        
        /* Universal Tag Pill */
        .tag-pill {
            background: white;
            border: 1px solid #999;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            color: #444;
            font-weight: 400;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            transition: all 0.2s ease;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }
        .tag-pill:hover {
            background-color: #E5E5E5;
            border-color: #666;
            color: #000;
        }

        .card-body { padding: 30px; display: flex; flex-direction: column; flex-grow: 1; }
        h3.card-title { 
            font-size: 16px; font-weight: 700; margin: 0 0 15px 0; color: var(--text-black); 
        }
        p.card-desc { 
            font-size: 16px; line-height: 1.5; color: var(--text-black); margin: 0 0 20px 0; flex-grow: 1; 
        }
        .card-footer { display: flex; justify-content: space-between; align-items: flex-end; }
        .tags-bottom { display: flex; flex-wrap: wrap; gap: 8px; }

        .btn-arrow {
            width: 40px; height: 40px; border: 1px solid #E5E5E5; border-radius: 2px;
            display: flex; align-items: center; justify-content: center;
            color: var(--swiss-red); flex-shrink: 0; transition: all 0.2s;
        }
        .btn-arrow .material-symbols-rounded { font-size: 22px; }
        .card:hover .btn-arrow { border-color: var(--swiss-red); background: var(--swiss-red); color: white; }

        /* --- 8. LIST VIEW (New) --- */
        .list-table { width: 100%; border-collapse: collapse; font-size: 15px; margin-bottom: 80px; }
        .list-table th {
            text-align: left; background: #F2F4F5; padding: 15px;
            color: #666; font-size: 13px; font-weight: 700; text-transform: uppercase;
        }
        .list-table td { padding: 20px 15px; border-bottom: 1px solid #E5E5E5; vertical-align: middle; }
        .list-table tbody tr { cursor: pointer; transition: background-color 0.1s; }
        .list-table tbody tr:hover { background-color: #F2F4F5; }
        
        .col-title { font-weight: 700; font-size: 16px; color: var(--text-black); width: 25%; }
        .col-desc { color: var(--text-black); line-height: 1.5; }
        .col-tags { width: 30%; text-align: right; }

        /* --- DETAIL VIEW SPECIFIC --- */
        .detail-hero { display: flex; gap: 50px; margin-bottom: 60px; margin-top: 20px; }
        .detail-info { flex: 1; }
        .detail-image-box { flex: 1; max-width: 600px; }
        .detail-image-box img { width: 100%; height: auto; border-radius: 2px; }
        .detail-tags { display: flex; gap: 10px; margin-bottom: 25px; }
        #detail-desc { font-size: 18px; line-height: 1.6; margin-bottom: 30px; }

        .responsible-box {
            background: #F5F5F5; padding: 30px; margin: 50px 0; border-left: 5px solid #ddd;
        }
        .box-title { font-weight: bold; margin-bottom: 8px; font-size: 18px; }
        .box-text { font-size: 16px; font-style: italic; color: #666; }

        .section-title { font-size: 24px; font-weight: 400; margin: 50px 0 25px 0; }
        
        .meta-list { border-top: 1px solid #E5E5E5; }
        .meta-row {
            display: flex; padding: 16px 15px; border-bottom: 1px solid #E5E5E5;
            font-size: 16px; align-items: center; transition: background-color 0.1s;
        }
        .meta-row:hover { background-color: #F2F4F5; }
        .meta-key { width: 280px; font-weight: 400; flex-shrink: 0; color: var(--text-black); }
        .meta-val { color: #333; display: flex; align-items: center; line-height: 1.5; }
        
        /* Attributes Table */
        .attr-table { width: 100%; border-collapse: collapse; font-size: 15px; margin-top: 20px; }
        .attr-table th {
            text-align: left; background: #F2F4F5; padding: 16px;
            color: #666; font-size: 13px; font-weight: 700; text-transform: uppercase;
        }
        .attr-table td { padding: 16px; border-bottom: 1px solid #E5E5E5; vertical-align: top; line-height: 1.5; }
        .attr-table tbody tr:hover { background-color: #F2F4F5; }
        
        .badge-pk { border: 1px solid #333; color: #333; padding: 2px 8px; border-radius: 10px; font-size: 12px; font-weight: bold; }
        .badge-fk { border: 1px solid #666; color: #666; padding: 2px 8px; border-radius: 10px; font-size: 12px; }
        .badge-val { border: 1px solid #999; padding: 2px 10px; border-radius: 10px; font-size: 12px; background: white; }
        .fmt-pill { border: 1px solid #ccc; padding: 2px 10px; border-radius: 12px; font-size: 13px; }

    </style>
</head>
<body>

    <div class="container">
        <!-- HEADER -->
        <header>
            <div class="header-inner">
                <div class="branding">
                    <div class="logo-wrapper">
                        <div class="swiss-shield"><div class="swiss-cross"></div></div>
                    </div>
                    <div class="branding-text">
                        <strong>Bundesamt für Bauten und Logistik BBL</strong>
                        <span>Bereich Bauten</span>
                        <span>Datenkatalog</span>
                    </div>
                </div>
                <div class="top-meta">
                    <a href="#">Kontakt</a>
                    <a href="#">Export</a>
                    <div class="lang-selector">DE <span class="material-symbols-rounded">expand_more</span></div>
                </div>
            </div>

            <div class="nav-tabs">
                <div class="nav-link active">Logisches Datenmodell</div>
                <div class="nav-link">Datenkatalog</div>
                <div class="nav-link">Über diesen Datenkatalog</div>
                <div class="nav-link">Handbuch</div>
            </div>
        </header>

        <!-- SUB HEADER -->
        <div class="sub-header">
            <div class="breadcrumbs" id="breadcrumbs">
                Startseite <span>></span> Logisches Datenmodell
            </div>
            <div class="action-icons">
                <div class="icon-btn" title="Print"><span class="material-symbols-rounded">print</span></div>
                <div class="icon-btn" title="Share"><span class="material-symbols-rounded">share</span></div>
            </div>
        </div>

        <main>
            <!-- === CATALOG WRAPPER === -->
            <div id="view-catalog">
                <h1 class="page-title">Logisches Datenmodell</h1>
                
                <!-- Controls -->
                <div class="toolbar">
                    <div class="search-group">
                        <div class="input-wrapper">
                            <span class="material-symbols-rounded search-icon">search</span>
                            <input type="text" id="searchInput" placeholder="Suchen">
                        </div>
                        <button class="btn-filter">
                            <span class="material-symbols-rounded">filter_list</span>
                            Filter anzeigen
                        </button>
                    </div>
                    <div class="view-toggles">
                        <div id="btn-grid" class="toggle-icon active" onclick="switchView('grid')">
                            <span class="material-symbols-rounded">grid_view</span>
                        </div>
                        <div id="btn-list" class="toggle-icon inactive" onclick="switchView('list')">
                            <span class="material-symbols-rounded">view_list</span>
                        </div>
                    </div>
                </div>

                <!-- Grid View Container -->
                <div id="grid-container" class="grid"></div>

                <!-- List View Container -->
                <table id="list-container" class="list-table hidden">
                    <thead>
                        <tr>
                            <th>KONZEPT</th>
                            <th>BESCHREIBUNG</th>
                            <th style="text-align:right">SCHLÜSSELWÖRTER</th>
                        </tr>
                    </thead>
                    <tbody id="list-body"></tbody>
                </table>
            </div>

            <!-- === DETAIL VIEW === -->
            <div id="view-detail" class="hidden">
                <h1 class="page-title" id="detail-title">Title</h1>
                
                <div class="detail-hero">
                    <div class="detail-info">
                        <div class="detail-tags" id="detail-tags"></div>
                        <p id="detail-desc">Desc</p>
                    </div>
                    <div class="detail-image-box">
                        <img id="detail-img" src="" alt="">
                    </div>
                </div>

                <div class="responsible-box">
                    <div class="box-title">Verantwortliche Person</div>
                    <div class="box-text">Niemand fühlt sich für diesen Datensatz zuständig – höchste Zeit, jemandem diese Ehre zu erteilen!</div>
                </div>

                <h3 class="section-title">Metadaten</h3>
                <div class="meta-list" id="meta-list"></div>

                <h3 class="section-title">Standards</h3>
                <div class="meta-list" id="standards-list"></div>

                <h3 class="section-title">Attribute</h3>
                <table class="attr-table">
                    <thead>
                        <tr>
                            <th style="width:20%">NAME</th>
                            <th style="width:15%">FORMAT</th>
                            <th style="width:10%">SCHLÜSSEL</th>
                            <th style="width:15%">WERTELISTE</th>
                            <th>BESCHREIBUNG</th>
                        </tr>
                    </thead>
                    <tbody id="attr-body"></tbody>
                </table>
                <div style="height:100px;"></div>
            </div>
        </main>
    </div>

    <script>
        let db = [];
        let currentView = 'grid'; // 'grid' or 'list'
        let currentFilter = '';

        // 1. Initialize
        async function init() {
            try {
                const res = await fetch('data.json');
                db = await res.json();
                
                window.addEventListener('hashchange', handleRoute);
                handleRoute(); // Initial load

                document.getElementById('searchInput').addEventListener('input', (e) => {
                    currentFilter = e.target.value.toLowerCase();
                    renderCurrentView();
                });
            } catch (e) {
                console.error("Load failed", e);
            }
        }

        // 2. Routing
        function handleRoute() {
            const hash = window.location.hash;
            if (hash.startsWith('#/detail/')) {
                const id = hash.split('/')[2];
                renderDetail(id);
            } else {
                showCatalog();
            }
        }

        function showCatalog() {
            document.getElementById('view-catalog').classList.remove('hidden');
            document.getElementById('view-detail').classList.add('hidden');
            document.getElementById('breadcrumbs').innerHTML = `Startseite <span>></span> Logisches Datenmodell`;
            renderCurrentView();
        }

        // 3. View Switching Logic
        function switchView(view) {
            currentView = view;
            
            // Update Toggle Buttons styling
            const gridBtn = document.getElementById('btn-grid');
            const listBtn = document.getElementById('btn-list');
            
            if(view === 'grid') {
                gridBtn.className = 'toggle-icon active';
                listBtn.className = 'toggle-icon inactive';
                document.getElementById('grid-container').classList.remove('hidden');
                document.getElementById('list-container').classList.add('hidden');
            } else {
                gridBtn.className = 'toggle-icon inactive';
                listBtn.className = 'toggle-icon active';
                document.getElementById('grid-container').classList.add('hidden');
                document.getElementById('list-container').classList.remove('hidden');
            }
            renderCurrentView();
        }

        function renderCurrentView() {
            const filtered = db.filter(i => i.title.toLowerCase().includes(currentFilter));
            
            if (currentView === 'grid') {
                renderGrid(filtered);
            } else {
                renderList(filtered);
            }
        }

        // Render Grid (Cards)
        function renderGrid(items) {
            const container = document.getElementById('grid-container');
            container.innerHTML = items.map(item => `
                <div class="card" onclick="window.location.hash='#/detail/${item.id}'">
                    <div class="card-img-wrap">
                        <img src="${item.image}" class="card-img">
                        <div class="tags-overlay">
                            ${(item.topTags || []).map(t => `<span class="tag-pill">${t}</span>`).join('')}
                        </div>
                    </div>
                    <div class="card-body">
                        <h3 class="card-title">${item.title}</h3>
                        <p class="card-desc">${item.description}</p>
                        <div class="card-footer">
                            <div class="tags-bottom">
                                ${(item.bottomTags || []).map(t => `<span class="tag-pill">${t}</span>`).join('')}
                            </div>
                            <div class="btn-arrow">
                                <span class="material-symbols-rounded">arrow_forward</span>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Render List (Table)
        function renderList(items) {
            const tbody = document.getElementById('list-body');
            tbody.innerHTML = items.map(item => {
                // Combine all tags for the list view
                const allTags = [...(item.topTags || []), ...(item.bottomTags || [])];
                
                return `
                <tr onclick="window.location.hash='#/detail/${item.id}'">
                    <td class="col-title">${item.title}</td>
                    <td class="col-desc">${item.description}</td>
                    <td class="col-tags">
                        ${allTags.map(t => `<span class="tag-pill" style="margin-left:5px; margin-bottom:5px;">${t}</span>`).join('')}
                    </td>
                </tr>
            `}).join('');
        }

        // 4. Detail View Renderer
        function renderDetail(id) {
            const item = db.find(x => x.id === id);
            if (!item) return showCatalog();

            document.getElementById('view-catalog').classList.add('hidden');
            document.getElementById('view-detail').classList.remove('hidden');
            
            document.getElementById('breadcrumbs').innerHTML = `
                <a href="#">Startseite</a> <span>></span> 
                <a href="#">Logisches Datenmodell</a> <span>></span> 
                ${item.title}
            `;

            document.getElementById('detail-title').textContent = item.title;
            document.getElementById('detail-desc').textContent = item.fullDescription || item.description;
            document.getElementById('detail-img').src = item.image;

            const tagsContainer = document.getElementById('detail-tags');
            tagsContainer.innerHTML = [
                ...(item.topTags || []), 
                ...(item.bottomTags || [])
            ].map(t => `<span class="tag-pill">${t}</span>`).join('');

            const metaContainer = document.getElementById('meta-list');
            
            // HARDCODED METADATA FIELDS DEFINITION
            const metaFields = [
                { key: 'fachliche_id', label: 'Fachliche ID' },
                { key: 'guid', label: 'GUID' },
                { key: 'termdat', label: 'TERMDAT' },
                { key: 'fachbereich', label: 'Fachbereich' },
                { key: 'system', label: 'Führendes System' },
                { key: 'klassifizierung', label: 'Klassifizierung' },
                { key: 'personenbezogen', label: 'Personenbezogene Daten' },
                { key: 'kommentar', label: 'Kommentar' },
                { key: 'version', label: 'Version' }
            ];

            if(item.meta) {
                metaContainer.innerHTML = metaFields.map(field => {
                    const val = item.meta[field.key] || '-'; // Default to "-"
                    let displayVal = val;

                    // Apply pill style to specific fields
                    if (['klassifizierung', 'personenbezogen', 'fachliche_id'].includes(field.key) && val !== '-') {
                        displayVal = `<span class="tag-pill">${val}</span>`;
                    }
                    // Apply link style to termdat
                    if (field.key === 'termdat' && val.startsWith('http')) {
                        displayVal = `<a href="${val}" target="_blank" style="text-decoration:underline;">${val}</a>`;
                    }

                    return `
                        <div class="meta-row">
                            <div class="meta-key">${field.label}</div>
                            <div class="meta-val">${displayVal}</div>
                        </div>
                    `;
                }).join('');
            } else { 
                metaContainer.innerHTML = '<div class="meta-row">Keine Metadaten</div>'; 
            }

            const stdContainer = document.getElementById('standards-list');
            if (item.standards && item.standards.length > 0) {
                stdContainer.innerHTML = item.standards.map(s => `
                    <div class="meta-row">
                        <div class="meta-key">${s.name}</div>
                        <div class="meta-val">${s.value}</div>
                    </div>
                `).join('');
            } else { stdContainer.innerHTML = ''; }

            const attrBody = document.getElementById('attr-body');
            if (item.attributes && item.attributes.length > 0) {
                attrBody.innerHTML = item.attributes.map(a => {
                    let keyBadge = '-';
                    if (a.key === 'PK') keyBadge = '<span class="badge-pk">PK</span>';
                    if (a.key === 'FK') keyBadge = '<span class="badge-fk">FK</span>';
                    let listBadge = a.list === '-' ? '-' : `<span class="badge-val">${a.list}</span>`;
                    return `
                        <tr>
                            <td>${a.name}</td>
                            <td><span class="fmt-pill">${a.format}</span></td>
                            <td>${keyBadge}</td>
                            <td>${listBadge}</td>
                            <td>${a.desc}</td>
                        </tr>
                    `;
                }).join('');
            } else { attrBody.innerHTML = '<tr><td colspan="5">Keine Attribute definiert</td></tr>'; }
        }

        // Expose switchView globally so onclick works
        window.switchView = switchView;

        init();
    </script>
</body>
</html>
